# DavisLib

A python wrapper library to access Davis image sets from python.

The `davislib` package contains wrapper classes around the `readimx` library from LaVision to access Davis image sets and the containing image buffers and frames. Internally the package uses the `readimx` library and the matlab engine, so `Matlab` and the matlab engine need to be installed. 

Accessing a Davis image set using the wrapper class:

```python
import davislib

image_set = davislib.DavisSet('path-to-set-file')
print('Number of frame buffers:', len(image_set))

frame = image_set.get_buffer(0).get_frame()
```

## Required third-party tools & libraries

### Matlab

To call Matlab routines or functions from python, firstly Matlab must be installed locally and secondly the python matlab engine library must be installed into the python environment. Currently, matlab only supports python versions `v3.5` to `v3.7`. For the installation of the matlab engine follow these steps:

1. Open a terminal or command prompt.
2. Activate your python environment for the project, if not already activated. For example:

   ```cmd
   conda activate AxSymJet
   ```

3. Go to the folder that contains the installer of the matlab python library:

   ```cmd
   cd matlabroot\extern\engines\python
   ```

   Replace `matlabroot` with the Matlab installation folder.

4. Run the installer:

   ```cmd
   python .\setup.py build --build-base c:\tmp install
   ```

   The Matlab library is build in the folder "`c:\tmp`" and then installed into the `site-packages` directory of the active python environment.


### LaVision & Davis generated image sets

To read image and vector data files generated by the Davis software package (LaVision) directly in Matlab or python, the free `readimx` Matlab library (LaVision, <https://www.lavision.de>, current version 2.1.8, closed source) is required. A pure python library for accessing the Davis files does not exist at the moment.

> The repository includes a version of the `readimx` library, so it does not need to be installed separately.

> The inclusion of the `readimx` library prevents the Python package from being published. Only internal use is allowed.

To directly access the `readimx` function from python:

1. Download the `readimx` library from LaVision and extract the contents in a folder of your choice.
2. Set the `READIMX_PATH` environment variable to the path that contains the pre-compiled `readimx.mexw64` file.
3. Access the `readimx` function from python via the matlab engine:

   ```python
   import matlab.engine
   from environs import Env

   # load environment variables
   env = Env()
   env.read_env()

   # start the matlab engine and add the readimx path
   eng = matlab.engine.start_matlab()
   eng.addpath(env('READIMX_PATH'))
   
   # load image data
   img_data = eng.readimx('path_to_image_file')
   ```

